(ns aoc.y2024.day8
  (:require 
   [aoc.coord :as coord]
   [clojure.string :as str]))

(defn solve [input]
  (let [lines (str/split-lines input)
        maxXY (count lines)
        grid (group-by first (for [[line y] (map vector lines (range))
                                   [ch x] (map vector (char-array line) (range))
                                   :when (java.lang.Character/isLetterOrDigit ch)]
                               [ch [x y]]))
        signals (into {} (for [[k v] grid] [k (mapv second v)]))]
    (count (set (for [coords (vals signals)
                      c1 coords
                      c2 coords
                      :when (not (= c1 c2))
                      :let [antinode [(- (first c1) (- (first c2) (first c1))) (- (second c1) (- (second c2) (second c1)))]]
                      :when (and 
                              (<= 0 (first antinode))
                              (<= 0 (second antinode))
                              (< (first antinode) maxXY)
                              (< (second antinode) maxXY))]
                  antinode)))))

(defn solve2 [input] 
  (let [lines (str/split-lines input)
        maxXY (count lines)
        grid (group-by first (for [[line y] (map vector lines (range))
                                   [ch x] (map vector (char-array line) (range))
                                   :when (java.lang.Character/isLetterOrDigit ch)]
                               [ch [x y]]))
        signals (into {} (for [[k v] grid] [k (mapv second v)]))]
    (count (set (for [coords (vals signals)
                      c1 coords
                      c2 coords
                      :when (not (= c1 c2))
                      :let [d (mapv - c1 c2)]
                      antinode (->> 
                                  (iterate #(mapv - % d) c1)
                                  (take-while (fn [a]
                                                (and 
                                                  (<= 0 (first a)) 
                                                  (<= 0 (second a)) 
                                                  (< (first a) maxXY) 
                                                  (< (second a) maxXY)))))
                      ]
                  antinode)))))

(comment
  (solve input)
  (solve2 input))

(def input "...............................s..................
..................s..............q.............p..
.....a............................................
........c......Y.......Q..........................
............................................4.....
........Y.........y............m..........4.......
......................Y...s..........S............
.........................................S........
...............N.............y....................
...........a.......y..................1...........
................................................S.
...c........k.............q....t............S.....
.............................qM...................
........a.........................................
..................................................
..................................................
..c..........k...Q..q....P........................
5.................Q...................8...........
......yc..........................................
........................E............4............
.........6........................u..p.....4......
.........5.............P..n......1.........N......
6..............................1.........J.t......
..6..................................3.u..t.....p.
....5...k..........................u..............
.......................E..................u....x..
..................E.................x.............
...k..................P.............3.............
...........0.....9.5...........E.........31e....N.
......0.................................N.........
.................CU.....................t....x....
......7....................e......................
....0..........K......C...........................
.....6....j......M............................J...
......K.................................p.........
.....9........................U...................
............................3....n................
.............K.........2.....C..................x.
....................P........UJ...................
.....0......X...C.........T..............U........
.......M.....8j....7.............2........Q.......
9...............K.................................
....e.....8.........................2.A.m.........
..e......8.........s...n..........................
.....................................T..nm........
...................X............2.........m......A
......................X..j....................T...
.........7..M......j.............T................
....9...7....................................A....
..........................................A.......")